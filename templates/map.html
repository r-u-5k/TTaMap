{% extends "base.html" %} 

{% block title %}네이버 지도 길찾기{% endblock %} 

{% block content %}
<h2>네이버 지도 길찾기</h2>

<div id="map" style="width: 100%; height: 600px"></div>
<div id="directions" style="margin-top: 20px">
  <label for="start">출발지:</label>
  <input type="text" id="start" value="서울역" />
  <label for="end">도착지:</label>
  <input type="text" id="end" value="남산" />
  <button onclick="findRoute()">길찾기</button>
</div>
<div id="route" style="margin-top: 20px">
  <!-- 경로 안내 결과가 여기에 표시됩니다 -->
</div>

<script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=hkatilxnt0"></script>
<script>
  const map = new naver.maps.Map('map', {
    center: new naver.maps.LatLng(37.5665, 126.978), // 서울 중심 좌표
    zoom: 14,
  });

  function findRoute() {
    const start = document.getElementById('start').value;
    const end = document.getElementById('end').value;

    naver.maps.Service.geocode({ query: start }, function (startResult, status) {
      if (status !== naver.maps.Service.Status.OK) {
        alert('출발지 주소를 찾을 수 없습니다.');
        return;
      }

      naver.maps.Service.geocode({ query: end }, function (endResult, status) {
        if (status !== naver.maps.Service.Status.OK) {
          alert('도착지 주소를 찾을 수 없습니다.');
          return;
        }

        const startLocation = startResult.v2.addresses[0];
        const endLocation = endResult.v2.addresses[0];

        const startLatLng = new naver.maps.LatLng(parseFloat(startLocation.y), parseFloat(startLocation.x));
        const endLatLng = new naver.maps.LatLng(parseFloat(endLocation.y), parseFloat(endLocation.x));

        const directionsService = new naver.maps.DirectionsService();
        const directionsRenderer = new naver.maps.DirectionsRenderer({
          map: map,
          panel: document.getElementById('route'),
        });

        directionsService.route(
          {
            start: startLatLng,
            goal: endLatLng,
            option: naver.maps.DirectionsService.Option.PATH, // 경로 탐색
          },
          function (response, status) {
            if (status === naver.maps.DirectionsService.Status.OK) {
              directionsRenderer.setDirections(response);
            } else {
              alert('길찾기 실패: ' + status);
            }
          }
        );

        map.setCenter(startLatLng); // 출발지로 지도 중심 이동
      });
    });
  }
</script>
{% endblock %}
